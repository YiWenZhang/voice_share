{% extends "admin/dashboard.html" %}
{% set active_page = 'insights' %}

{% block admin_main %}
<div class="module-header">
  <div class="module-title">
    <h1><i class="ri-disc-line" style="color: #6366f1;"></i> 全平台音乐库</h1>
    <p>基于 <code>v_music_full_info</code> 视图的完整数据映射</p>
  </div>
  <div class="header-status">
    <a href="{{ url_for('db_views.admin_query_center') }}" class="modern-action-btn" style="background: rgba(255,255,255,0.5); border: 1px solid rgba(255,255,255,0.6); padding: 0.6rem 1.2rem; border-radius: 99px; cursor: pointer; color: #475569; font-weight: 600; text-decoration: none; display: flex; align-items: center; gap: 6px; transition: all 0.2s;">
      <i class="ri-arrow-left-line"></i> 返回中心
    </a>
  </div>
</div>

<section class="grid-card">
  <div class="table-scroll">
    <table class="data-table">
      <thead>
        <tr>
          <th style="padding-left: 1.5rem;">ID</th>
          <th>歌曲信息</th>
          <th>上传者</th>
          <th>当前状态</th>
          <th>上传时间</th>
        </tr>
      </thead>
      <tbody>
        {% for m in musics %}
        <tr>
          <td style="padding-left: 1.5rem; color: #64748b; font-family: monospace;">#{{ m.music_id }}</td>
          <td>
            <div style="font-weight: 700; color: #1e293b;">{{ m.title }}</div>
            <div style="font-size: 0.85rem; color: #64748b; margin-top: 4px;">{{ m.original_filename }}</div>
          </td>
          <td>
            <div style="display: flex; align-items: center; gap: 10px;">
              <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #e0e7ff, #c7d2fe); color: #4338ca; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.9rem;">
                {{ m.uploader_nickname[0] }}
              </div>
              <div>
                <div style="font-weight: 600; color: #334155; font-size: 0.9rem;">{{ m.uploader_nickname }}</div>
                <div style="font-size: 0.75rem; color: #94a3b8;">@{{ m.uploader_name }}</div>
              </div>
            </div>
          </td>
          <td>
            {% if m.status == 'approved' %}
              <span style="background: rgba(220, 252, 231, 0.6); color: #166534; padding: 4px 10px; border-radius: 6px; font-size: 0.85rem; font-weight: 600;">已发布</span>
            {% elif m.status == 'pending' %}
              <span style="background: rgba(255, 237, 213, 0.6); color: #c2410c; padding: 4px 10px; border-radius: 6px; font-size: 0.85rem; font-weight: 600;">待审核</span>
            {% else %}
              <span style="background: rgba(254, 226, 226, 0.6); color: #991b1b; padding: 4px 10px; border-radius: 6px; font-size: 0.85rem; font-weight: 600;" title="{{ m.rejection_reason }}">已驳回</span>
            {% endif %}
          </td>
          <td style="color: #64748b;">{{ m.uploaded_at.strftime('%Y-%m-%d') }}</td>
        </tr>
        {% else %}
        <tr><td colspan="5" style="text-align: center; padding: 4rem 0; color: #64748b;">暂无数据</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}